# db for local dev
version: '3.9'

services:
  postgresql:
    image: postgres:12.9-alpine # matches version used on aws environments
    container_name: pg-devices-api
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=dimo
      - POSTGRES_PASSWORD=dimo
      - POSTGRES_DB=devices_api
    volumes:
      - ./resources/data:/var/lib/postgresql/data:delegated
  redis:
    image: redis:6.2 # latest version on ElastiCache
    container_name: redis-devices-api
    ports:
      - "6379:6379"
    volumes:
      - ./resources/redis:/data:delegated
## issue with ports, could not get app to connect to kafka, using brew services instead
#  kafka:
#    container_name: devices-api-kafka
#    image: johnnypark/kafka-zookeeper
#    ports:
#      - "9092:9092"
#    volumes:
#      - /var/run/docker.sock:/var/run/docker.sock
#    environment:
#      ADVERTISED_HOST: 127.0.0.1
#      NUM_PARTITIONS: 5
#      TOPICS: "topic.interface.ingest.smartcar, topic.device.status"
